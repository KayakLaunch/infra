AWSTemplateFormatVersion: 2010-09-09
Description: Persistent data stores for KayakLaunch.

Parameters:
  stage:
    Type: String
    Default: "development"
    Description: "The lifecycle stage of resources created buy this stack. All resources will be automatically tagged with this."

Resources:
  tableRoutes:
    Type: "AWS::DynamoDB::Table"
    Properties:
      TableName: 
        Fn::Join:
          - ''
          - - "kayaklaunch-routes-"
            - !Ref stage
      AttributeDefinitions:
        - 
          AttributeName: "name"
          AttributeType: "S"
        - 
          AttributeName: "routeID"
          AttributeType: "S"
        -
          AttributeName: "location"
          AttributeType: "S"
      KeySchema: 
        - 
          AttributeName: "routeID"
          KeyType: "HASH"
      ProvisionedThroughput: 
        ReadCapacityUnits: "1"
        WriteCapacityUnits: "1"
      GlobalSecondaryIndexes: 
        - 
          IndexName: "routesLocationIndex"
          KeySchema: 
            - 
              AttributeName: "location"
              KeyType: "HASH"
            - 
              AttributeName: "name"
              KeyType: "RANGE"
          Projection: 
            NonKeyAttributes: 
              - "routeID"
              - "location"
              - "name"
              - "descriptionShort"
              - "latlon"
            ProjectionType: "INCLUDE"
          ProvisionedThroughput: 
            ReadCapacityUnits: "1"
            WriteCapacityUnits: "1"
      Tags:
        - 
          Key: stage
          Value: !Ref stage
  bucketRoutes:
    Type: AWS::S3::Bucket
    Properties:
      BucketName:
        Fn::Join:
          - ''
          - - "kayaklaunch-routes-"
            - !Ref stage
      Tags:
        - 
          Key: stage
          Value: !Ref stage



      